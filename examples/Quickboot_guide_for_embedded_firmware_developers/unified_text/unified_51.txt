The system's initialization and control of peripheral devices, particularly in a Redundant Array of Independent Disks (RAID) configuration, involve a complex interplay between the system's Basic Input/Output System (BIOS) and specialized firmware, such as the RAID option Read-Only Memory (ROM). The RAID option ROM provides Int13h services, which are legacy BIOS routines designed to offer a pre-Operating System (OS) user interface for disk operations. This allows the system to interact with storage devices, such as those configured for RAID, before a full OS driver has been loaded and initialized.When the system BIOS configures the Serial Advanced Technology Attachment (SATA) controller for RAID mode, it must follow specific guidelines to ensure proper initialization and control. The system BIOS does not need to initialize Direct Memory Access (DMA) mode for Hard Disk Drives (HDDs) discovered behind the SATA controller when in RAID mode, as the RAID option ROM will provide this initialization. Additionally, SATA HDDs discovered by the system BIOS behind the SATA controller in RAID mode must not be added to the hard drive count at memory location hexadecimal 40:75, as the RAID option ROM will enumerate these drives and update the count accordingly.The system BIOS must also refrain from installing Int13h support for SATA HDD devices discovered in RAID mode, nor should it treat these devices as BIOS-Aware Initial Program Load (BAID) devices, as the RAID option ROM implements the necessary Int13h support. However, Advanced Technology Attachment Packet Interface (ATAPI) devices attached to the SATA controller must be under the full control of the system BIOS and treated as BAID devices, as they are in non-RAID mode.The RAID option ROM is delivered as a single, uncompressed binary image compiled for the 16-bit real mode environment. To conserve system flash space, the integrator may compress the image for inclusion into the system BIOS. The RAID option ROM will first attempt to rely on the interrupt-driven mechanism handled by the system BIOS and then fall back to the polling mechanism if the system BIOS does not support the interrupt-driven mechanism.The initialization sequence for RAID mode involves the system BIOS configuring the SATA controller for RAID mode, initializing Input/Output Base Address Registers (IO BARs) and the Advanced Host Controller Interface (AHCI) Base Address Register (ABAR), and assigning an Interrupt Request (IRQ) to the controller. The system BIOS then loads the RAID option ROM, which provides the necessary Int13h services for disk access.When accessing an ATA device via Int13h services, the system BIOS uses the interrupt mechanism for efficient data transfer. If the system encounters an unexpected interrupt, it assumes this indicates a RAID request and clears the interrupt status in the SATA/RAID controller, sets a specific byte at memory address hexadecimal 40:8E to a nonzero value, and issues an End Of Interrupt (EOI) and Interrupt Return (IRET) instruction.The system BIOS can customize the RAID features through setting the Intel Rapid Storage Technology (RST) Feature Capabilities register before loading the RAID option ROM. For example, if the platform desires features such as RAID 0, RAID 1, RAID 5, and RAID 10, the system BIOS should set the RST Feature Capabilities register to a specific value before loading the RAID option ROM.In summary, the system BIOS plays a crucial role in initializing and controlling peripheral devices in a RAID configuration, working in conjunction with the RAID option ROM to provide the necessary Int13h services for disk access. The system BIOS must follow specific guidelines to ensure proper initialization and control, and the RAID option ROM provides the necessary functionality for efficient data transfer and customization of RAID features.

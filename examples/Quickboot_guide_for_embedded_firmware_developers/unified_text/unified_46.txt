The management of Universal Serial Bus, or U S B, functionality at the foundational hardware layer involves intricate interactions with various registers and control mechanisms, primarily orchestrated by the system's B I O S or firmware. Prior to effectively rendering a U S B host controller non-operational, a methodical sequence of register manipulations is imperative to ensure system stability and proper state transitions. This process begins with controlling the operational state of the U S B host controllers, specifically targeting the E H C I and U H C I implementations. To achieve this, the Run/Stop bit within the host controller's command register must be cleared, signaling the host controller to cease all ongoing operations and transition into a halted state. It is critical to verify that the H C Halted bit, a status indicator, subsequently becomes set, confirming that the controller has indeed entered the desired quiescent state. Following the halting procedure, it is crucial to manage the interrupt landscape by setting the Interrupt disable bit, located at P C I Configuration Space offset hexadecimal zero four, specifically at bit index ten, for both E H C I and U H C I controllers. Further control over the U S B two point zero controller's operational modes involves disabling its scheduling capabilities. This is accomplished by clearing two distinct bits within the U S B two zero M E M underscore B A S E register: the Asynchronous schedule enable bit and the Periodic schedule enable bit. By disabling these fundamental scheduling mechanisms, the controller is effectively prevented from initiating or managing any U S B data transfers, thereby completing its functional disablement. Additionally, the system's wake capabilities via U S B must be addressed by configuring specific bits related to wake events across various components.Once these settings are configured, the device will remain disabled until the next platform reset occurs. The policy for disabling E H C I functionality is not dynamic, and this restriction also applies to subsequent warm boots. Beyond disabling the entire host controller, granular control over individual U S B ports is also a critical capability, often implemented by the system B I O S for power management or enhanced security. Each U S B port on the Platform Controller Hub, or P C H, has a corresponding control bit within the P C H U S B Port Disable Override Register. Setting the appropriate bit in this register for a given port effectively disables it, and to ensure the integrity and persistence of these port-specific disablement settings, a further security mechanism is often employed: the P C H U S B Per Port Register Write Control Register.The system's ability to wake from various A C P I sleep states via U S B activity is a significant power management feature. The E H C I host controllers are specifically designed with logic to detect activity on U S B ports even when the majority of the system is in a low-power state. Upon detecting a predefined event, such as a mouse movement or keyboard input, these controllers can generate an internally routed wake signal. This mechanism is crucial for user experience, allowing peripherals to bring the system out of sleep, while also requiring careful management to balance responsiveness with power efficiency and security.For supporting E H C I host controller wake in an A C P I environment, the _ P R W A C P I method package must be present under P C I Bus zero for each of the E H C I host controllers. This package describes the "Wake from U S B two point zero" functionality, ensuring that a U S B device can wake the system from a suspended state by generating activity on the U S B bus. The A C P I Source Language definitions for U S B devices provide the operating system with crucial metadata about the hardware, including the device's P C I address and the power resources necessary for the device to generate a wake event.U S B enumeration is the systematic process by which the U S B host controller discovers, identifies, and configures connected U S B devices. This critical procedure is handled in a multi-stage fashion, with the system B I O S initializing the E H C I hardware in two distinct phases: P C I enumeration and E H C I initialization. The B I O S places the E H C I into a fully functional state, performing the foundational setup, which includes programming the port routing and Mod P H Y settings, performing a Host Controller Reset, and implementing a required delay.Following these initial steps, the E H C I version proceeds to get a descriptor to know what is connected to the root port, which could be either a Hub or a Root port zero index identified as a hub. For a Hub, the B I O S configures it for address, waits for a specified delay, obtains the delay needed for power on, waits for that delay, and then configures each of the ports. It is recommended that the B I O S enable all the root ports in parallel to avoid additive serial time delays and then proceed with the configuration of the U S B network downstream. This process ensures seamless and efficient U S B device enumeration and configuration, supporting both power management and system functionality.

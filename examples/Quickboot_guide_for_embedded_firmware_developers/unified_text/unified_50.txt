The S A T A controller serves as a crucial interface between the host system and S A T A storage devices, supporting three distinct programming interfaces: a combination of legacy and native I D E, native I D E only, and A H C I. The maximum number of S A T A ports supported varies depending on the specific configuration, typically six or four. To access the maximum number of ports, the controller must be configured appropriately using the P C I standard programming interface register, D thirty one colon F two colon zero nine hexadecimal.When the S A T A controller is operating in I D E mode, the combination of legacy and native I D E can be used. However, this is only possible when the controller is specifically set to I D E operation. The P I register, located at D thirty one colon F two colon zero nine hexadecimal, contains two native mode enable bits that control the primary and secondary S A T A channels. These bits must be programmed identically to ensure consistent behavior across the channels. The P I register is found in both S A T A functions, but only S A T A one can be set to use legacy I D E, while S A T A two supports native I D E only and has a read-only P I register.If legacy I D E use is intended, the system B I O S must set the decode enable bits in the I D E Timing Registers, specifically at D thirty one colon F two colon four zero hexadecimal bracket one five bracket and D thirty one colon F five colon four two hexadecimal bracket one five bracket. When the S A T A controller is configured as R A I D or A H C I mode, the P I register becomes read-only, and the controller can use native I D E access mechanisms until the A E bit, A B A R zero four hexadecimal bracket three one bracket, is set. However, in R A I D and A H C I modes, native I D E will only allow access to the first four ports of the controller. To access the maximum of six ports, A H C I access mechanisms must be used.The initialization of registers within the A H C I memory-mapped space is a critical step in the controller's operational readiness when configured for R A I D or A H C I mode. The system B I O S must initialize the memory-mapped A H C I registers specified by A B A R, D thirty one colon F two colon two four hexadecimal. This includes setting the S S S bit in the C A P register, located at A B A R plus hexadecimal zero zero, to enable staggered spin-up on the controller's ports. Additionally, specific bits in other A B A R-relative registers must be cleared, and the P X C M D register must be configured.After the B I O S issues the initial write to the A H C I Ports Implemented register, two reads must be performed to ensure synchronization and prevent potential race conditions. Some bits in these registers are platform-specific and must be programmed according to the requirements outlined in the Serial A T A Advanced Host Controller Interface specification. Certain bits are also implemented as read/write once, requiring the system B I O S to program each bit at least once, even if the default setting is the desired value.When the S A T A controller is initialized in R A I D mode, the system B I O S must follow specific guidelines. The B I O S does not need to initialize D M A mode for H D Ds discovered behind the S A T A controller, as the R A I D option R O M will provide this initialization. S A T A H D Ds discovered by the B I O S in R A I D mode must not be added to the hard drive count at hexadecimal forty colon seventy five, as the R A I D option R O M will enumerate these drives and update the count accordingly. The B I O S must not install interrupt thirteen H support for S A T A H D D devices in R A I D mode, as the R A I D option R O M implements the necessary support. A T A P I devices attached to the S A T A controller must be under the full control of the system B I O S and treated as B A I D devices.The system B I O S must load the R A I D option R O M when the controller's S C C returns hexadecimal zero four and the Vendor I D slash Device I D matches that of the P C H R R A I D S K U. The Intel Rapid Storage Technology R A I D option R O M is a P n P option that provides the necessary functionality for R A I D configurations. By following these guidelines and properly initializing the S A T A controller and its associated devices, the system can ensure optimal performance, reliability, and functionality in various storage configurations.

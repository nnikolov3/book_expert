The Get P C I Interrupt Routing Options routine returns the P C I interrupt routing options available on the system motherboard and the current state of what interrupts are currently exclusively assigned to P C I. Routing information is returned in a data buffer that contains an I R Q routing for each P C I device or slot. The format of an entry in the I R Q routing table is detailed, with each field providing specific parameters for the interrupt routing.At offset zero, a single byte stores the P C I Bus Number, which uniquely identifies the specific bus to which the P C I device in question is attached. Following at offset one, another byte represents the P C I Device Number, specifying the unique identifier for a device on a particular P C I bus. The device number occupies the upper five bits of this byte and is shifted left three bits, implying that the lower three bits might be used to encode the P C I function number or are reserved.The core of the interrupt routing information begins at offset two, with a byte designated as the Link Value for I N T A sharp. This field describes the routing status for the I N T A sharp pin, with a value of zero indicating that this interrupt pin is not connected or routed to any interrupt controller pin within the system. Non-zero link values are specific to a chipset and are decided by the chipset vendor, with values ranging from one through the number of interrupt pins on the Interrupt Router indicating a direct connection to a specific P I R Q N sharp pin.At offset three, a word-sized field represents the I R Q Bitmap for I N T A sharp, providing a comprehensive view of the routing possibilities for the I N T A sharp interrupt. Each bit in this word corresponds to a standard A T I R Q line, with a one bit indicating that routing from this P C I device's I N T A sharp pin to the corresponding A T I R Q line is possible, and a zero bit signifying that such routing is not permissible.The structure repeats for I N T B sharp, I N T C sharp, and I N T D sharp, with each having its own distinct routing configuration and capabilities. Understanding this table is fundamental for operating systems to correctly identify, configure, and manage P C I devices, enabling them to communicate critical events to the C P U through the underlying interrupt subsystem.The dollar P I R Table, or P C I I R Q Routing Table, is a fundamental data structure residing in system memory, providing essential configuration information to the operating system regarding P C I interrupt routing. The table's header structure includes fields such as the signature, version, table size, P C I Interrupt Router's Bus, and P C I Exclusive I R Qs. The signature, expressed as the A S C I I string dollar sign P I R, serves as a unique identifier for the data structure, while the version information allows for backward compatibility and future extensibility of the table format.The P C I Interrupt Router's Bus and Dev Func fields provide critical information for identifying the interrupt router and its configuration, with the Device defined by the upper five bits and the Function by the lower three bits. The P C I Exclusive I R Qs field is an I R Q bitmap indicating which I R Qs are devoted exclusively to P C I usage, allowing the operating system to dynamically assign I R Qs to P C I devices while avoiding conflicts with other system components.The Compatible P C I Interrupt Router field contains the Vendor I D and Device I D of a compatible P C I Interrupt Router, enabling the operating system to load an existing I R Q driver on a new P C I chipset without updating any drivers or requiring user interaction. The Miniport Data field is passed directly to the I R Q Miniport's Initialize function, providing additional configuration information for the interrupt router.Finally, the Checksum field ensures the integrity of the table by verifying that the sum of all bytes in the P C I I R Q Routing Table, including the checksum, is zero modulo two hundred fifty-six. This mechanism prevents data corruption and ensures that the operating system can rely on the accuracy of the interrupt routing information provided by the dollar P I R Table.
